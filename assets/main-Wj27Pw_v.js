(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=o(e);fetch(e.href,t)}})();document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("intro"),s=document.getElementById("start-ar"),o=document.querySelector("a-scene"),c=document.getElementById("debug-panel"),e=document.getElementById("permission-help"),t=document.getElementById("perm-back"),i=document.getElementById("target-guide"),d=document.querySelector("[mindar-image-target]"),l=document.getElementById("exit-btn"),n=r=>{console.log("[DEBUG]",r),c&&(c.textContent="[DEBUG] "+r)};n("Waiting for Start AR…");let u="unknown";if(navigator.permissions&&navigator.permissions.query)try{navigator.permissions.query({name:"camera"}).then(r=>{u=r.state,n("Camera permission state: "+r.state+". Waiting for Start AR…")}).catch(()=>{})}catch{}const f=()=>{e&&(e.style.display="flex"),o&&(o.style.display="none")},g=()=>{e&&(e.style.display="none")},y=()=>{i&&(i.style.display="flex")},m=()=>{i&&(i.style.display="none")};t&&a&&t.addEventListener("click",()=>{g(),m(),a.style.display="flex",n("Returned to start screen. Waiting for Start AR…")}),l&&l.addEventListener("click",()=>{location.reload()}),s&&a&&o?s.addEventListener("click",async()=>{if(a.style.display="none",n("Start AR clicked. Checking camera permission…"),u==="denied"){n("Camera permission is DENIED. Showing help interface."),f();return}y(),o.style.display="block",l&&(l.style.display="block");const r=o?.systems?.["mindar-image-system"];if(r&&typeof r.start=="function")try{n("Starting AR. The browser may now show the official camera permission prompt."),await r.start(),n("AR started. Searching for target… Point your camera at the postcard / QR."),d&&(d.addEventListener("targetFound",()=>{n("TARGET FOUND – tracking active."),m()}),d.addEventListener("targetLost",()=>{n("Target lost – searching again…"),y()}))}catch(p){console.error("Error starting MindAR:",p),n("Error starting AR. Camera permission likely denied or unavailable."),f(),m()}else console.error("mindar-image-system not found on scene."),n("ERROR: mindar-image-system not found on scene.")}):(console.error("Missing start button, intro, or scene element."),n("ERROR: Missing start button, intro, or scene element."))});
