(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("intro"),o=document.getElementById("start-ar"),s=document.querySelector("a-scene"),c=document.getElementById("debug-panel"),e=document.getElementById("permission-help"),t=document.getElementById("perm-back"),i=document.getElementById("target-guide"),u=document.querySelector("[mindar-image-target]"),l=document.getElementById("artSceneObject"),d=document.getElementById("debugCube"),m=document.getElementById("exit-btn"),n=r=>{console.log("[DEBUG]",r),c&&(c.textContent="[DEBUG] "+r)};n("Waiting for Start AR…");let g="unknown";if(navigator.permissions&&navigator.permissions.query)try{navigator.permissions.query({name:"camera"}).then(r=>{g=r.state,n("Camera permission state: "+r.state+". Waiting for Start AR…")}).catch(()=>{})}catch{}const y=()=>{e&&(e.style.display="flex"),s&&(s.style.display="none")},E=()=>{e&&(e.style.display="none")},p=()=>{i&&(i.style.display="flex")},f=()=>{i&&(i.style.display="none")};t&&a&&t.addEventListener("click",()=>{E(),f(),a.style.display="flex",n("Returned to start screen. Waiting for Start AR…")}),m&&m.addEventListener("click",()=>{location.reload()}),o&&a&&s?o.addEventListener("click",async()=>{if(a.style.display="none",n("Start AR clicked. Checking camera permission…"),g==="denied"){n("Camera permission is DENIED. Showing help interface."),y();return}p(),s.style.display="block",m&&(m.style.display="block");const r=s?.systems?.["mindar-image-system"];if(r&&typeof r.start=="function")try{n("Starting AR. The browser may now show the official camera permission prompt."),await r.start(),n("AR started. Searching for target… Point your camera at the postcard / QR."),u&&(u.addEventListener("targetFound",()=>{n("TARGET FOUND – tracking active."),f(),l&&l.setAttribute("visible","true"),d&&d.setAttribute("visible","true")}),u.addEventListener("targetLost",()=>{n("Target lost – searching again…"),p(),l&&l.setAttribute("visible","false"),d&&d.setAttribute("visible","false")}))}catch(b){console.error("Error starting MindAR:",b),n("Error starting AR. Camera permission likely denied or unavailable."),y(),f()}else console.error("mindar-image-system not found on scene."),n("ERROR: mindar-image-system not found on scene.")}):(console.error("Missing start button, intro, or scene element."),n("ERROR: Missing start button, intro, or scene element."))});
