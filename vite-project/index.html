<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Art Room</title>
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />

    <!-- A-Frame and MindAR -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-ui.prod.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="./Style.css" />
  </head>

  <body>
    <!-- Debug info -->
    <div id="debug-panel">[DEBUG] Waiting for Start AR…</div>

    <!-- Intro screen -->
    <div id="intro">
      <div class="intro-box">
        <h1>AR Art Room</h1>
        <p>
          This WebXR experience transforms a simple postcard into a small museum
          room in augmented reality. Point your camera at the target to reveal
          the 3D paintings in real space.
        </p>
        <button id="start-ar">Start AR</button>
        <p class="note">
          Tip: open this page on a smartphone or tablet and allow camera access.
        </p>
      </div>
    </div>

    <!-- Camera permission help -->
    <div id="permission-help">
      <div class="perm-box">
        <h2>Camera Access Required</h2>
        <p>
          Camera access is required to continue. To enable the camera for this site:
        </p>
        <ul>
          <li>Open your browser settings for this website (lock icon or "aA").</li>
          <li>Find the <strong>Camera</strong> permission.</li>
          <li>Set it to <strong>Allow</strong>.</li>
          <li>Reload the page and press <strong>Start AR</strong> again.</li>
        </ul>
        <button id="perm-back">Return to Start Screen</button>
      </div>
    </div>

    <!-- Target guide overlay -->
    <div id="target-guide">
      <div class="target-guide-inner">
        <div class="target-frame"></div>
        <div class="target-text">Center the postcard / QR inside this frame</div>
      </div>
    </div>

    <!-- Exit button (visible only in AR mode) -->
    <button id="exit-btn" style="display:none;">Exit</button>

    <!-- Model navigation (visible only in AR mode) -->
    <div id="model-nav" style="display:none;">
      <button id="prev-model" aria-label="Previous model">◀</button>
      <button id="next-model" aria-label="Next model">▶</button>
    </div>

    <!-- AR scene -->
    <a-scene
      mindar-image="imageTargetSrc: ./target.mind;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
      style="display: none;"
    >
      <a-assets>
        <a-asset-item id="paintModel1" src="./paint_1.glb"></a-asset-item>
        <a-asset-item id="paintModel2" src="./paint_2.glb"></a-asset-item>
        <a-asset-item id="paintModel3" src="./paint_3.glb"></a-asset-item>
      </a-assets>

      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="0 1 1"></a-entity>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-gltf-model
          id="paintModelEntity1"
          src="#paintModel1"
          position="0 0 0"
          rotation="90 90 90"
          scale="0.08 0.08 0.08"
          visible="true">
        </a-gltf-model>

        <a-gltf-model
          id="paintModelEntity2"
          src="#paintModel2"
          position="0 0 0"
          rotation="90 90 90"
          scale="0.08 0.08 0.08"
          visible="false">
        </a-gltf-model>

        <a-gltf-model
          id="paintModelEntity3"
          src="#paintModel3"
          position="0 0 0"
          rotation="90 90 90"
          scale="0.08 0.08 0.08"
          visible="false">
        </a-gltf-model>
      </a-entity>
    </a-scene>

    <!-- TS entrypoint (Vite) -->
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>