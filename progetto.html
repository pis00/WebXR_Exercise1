    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const introEl = document.getElementById("intro");
        const startButton = document.getElementById("start-ar");
        const sceneEl = document.querySelector("a-scene");
        const debugEl = document.getElementById("debug-panel");
        const targetEntity = document.querySelector("[mindar-image-target]");

        const cameraPermissionEl = document.getElementById("camera-permission");
        const camYesBtn = document.getElementById("cam-yes");
        const camNoBtn = document.getElementById("cam-no");
        const cameraMessageEl = document.getElementById("camera-message");

        const logDebug = (msg) => {
          console.log("[DEBUG]", msg);
          if (debugEl) {
            debugEl.textContent = "[DEBUG] " + msg;
          }
        };

        // Initial debug message
        logDebug("DOM loaded. Waiting for Start AR…");

        // Try to read current camera permission state (if supported)
        if (navigator.permissions && navigator.permissions.query) {
          try {
            navigator.permissions
              .query({ name: "camera" })
              .then((result) => {
                logDebug(
                  "DOM loaded. Camera permission state: " +
                    result.state +
                    ". Waiting for Start AR…"
                );
              })
              .catch(() => {
                // ignore errors, keep default debug text
              });
          } catch (e) {
            // ignore if Permissions API is not fully supported
          }
        }

        if (
          startButton &&
          introEl &&
          sceneEl &&
          cameraPermissionEl &&
          camYesBtn &&
          camNoBtn
        ) {
          // STEP 1: Click on Start AR -> show our camera permission screen
          startButton.addEventListener("click", () => {
            logDebug("Start AR clicked. Showing camera permission screen…");
            introEl.style.display = "none";
            sceneEl.style.display = "none";
            cameraPermissionEl.style.display = "flex";
            if (cameraMessageEl) {
              cameraMessageEl.textContent = "";
            }
          });

          // Function that actually requests camera permission and starts AR
          const requestCameraAndStart = async () => {
            logDebug("Requesting camera permission…");
            if (cameraMessageEl) {
              cameraMessageEl.textContent = "Richiesta di accesso alla fotocamera…";
            }

            if (
              !navigator.mediaDevices ||
              !navigator.mediaDevices.getUserMedia
            ) {
              logDebug("ERROR: getUserMedia not supported on this device.");
              if (cameraMessageEl) {
                cameraMessageEl.textContent =
                  "Questo dispositivo o browser non supporta l'accesso alla fotocamera.";
              }
              return;
            }

            try {
              // This will trigger the OFFICIAL browser prompt (if state is 'prompt')
              const stream = await navigator.mediaDevices.getUserMedia({
                video: true,
              });

              logDebug("Camera permission granted. Initializing AR…");

              // Stop the temporary stream; MindAR will open its own
              stream.getTracks().forEach((t) => t.stop());

              const arSystem = sceneEl.systems["mindar-image-system"];
              if (arSystem && arSystem.start) {
                cameraPermissionEl.style.display = "none";
                sceneEl.style.display = "block";

                try {
                  await arSystem.start();
                  logDebug("MindAR started. Point the camera at the target.");

                  if (targetEntity) {
                    targetEntity.addEventListener("targetFound", () => {
                      logDebug("TARGET FOUND");
                    });
                    targetEntity.addEventListener("targetLost", () => {
                      logDebug("Target lost…");
                    });
                  } else {
                    logDebug(
                      "WARNING: mindar-image-target entity not found in scene."
                    );
                  }
                } catch (e) {
                  console.error("Error starting MindAR:", e);
                  logDebug("ERROR starting MindAR. See console.");
                }
              } else {
                logDebug("ERROR: mindar-image-system not found on scene.");
                if (cameraMessageEl) {
                  cameraMessageEl.textContent =
                    "Errore interno: sistema AR non disponibile.";
                }
              }
            } catch (err) {
              console.error("Camera permission denied or failed:", err);
              logDebug("ERROR: Camera permission denied. AR cannot start.");
              if (cameraMessageEl) {
                cameraMessageEl.textContent =
                  "Non è possibile proseguire senza l'utilizzo della camera.\n" +
                  "Se hai bloccato la fotocamera per questo sito, vai nelle impostazioni del browser, abilita la fotocamera per 'github.io' e ricarica la pagina.";
              }
            }
          };

          // STEP 2: User clicks YES in our custom UI
          camYesBtn.addEventListener("click", () => {
            requestCameraAndStart();
          });

          // STEP 3: User clicks NO in our custom UI
          camNoBtn.addEventListener("click", () => {
            logDebug("User clicked NO on camera permission.");
            if (cameraMessageEl) {
              cameraMessageEl.textContent =
                "Non è possibile proseguire senza l'utilizzo della camera.";
            }
          });
        } else {
          logDebug(
            "ERROR: Missing start button, intro, scene, or camera permission UI elements."
          );
        }
      });
    </script>