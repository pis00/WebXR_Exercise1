<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scene 1 - Whale (Drag Rotate)</title>
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />

    <!-- A-Frame core + extras (already used in your project) -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>

    <!-- Drag-rotate component (Option A) -->
    <script>
      AFRAME.registerComponent('drag-rotate', {
        schema: {
          speed:   { type: 'number', default: 0.4 },
          invertX: { type: 'boolean', default: false },
          invertY: { type: 'boolean', default: false }
        },
        init: function () {
          this.isDragging = false;
          this.start = { x: 0, y: 0 };
          this.startRot = { x: 0, y: 0 };
          this.canvas = null;

          this.onPointerDown = this.onPointerDown.bind(this);
          this.onPointerMove = this.onPointerMove.bind(this);
          this.onPointerUp   = this.onPointerUp.bind(this);

          // Wait for scene/canvas, then attach listeners
          this.el.sceneEl.addEventListener('loaded', () => {
            this.canvas = this.el.sceneEl.canvas;
            if (!this.canvas) return;
            // Prevent browser gestures from interfering on touch
            this.canvas.style.touchAction = 'none';
            this.canvas.addEventListener('pointerdown', this.onPointerDown, { passive: true });
            window.addEventListener('pointermove', this.onPointerMove, { passive: true });
            window.addEventListener('pointerup', this.onPointerUp, { passive: true });
          });
        },
        remove: function () {
          if (!this.canvas) return;
          this.canvas.removeEventListener('pointerdown', this.onPointerDown);
          window.removeEventListener('pointermove', this.onPointerMove);
          window.removeEventListener('pointerup', this.onPointerUp);
        },
        onPointerDown: function (e) {
          this.isDragging = true;
          const rot = this.el.getAttribute('rotation') || { x: 0, y: 0, z: 0 };
          this.startRot.x = rot.x;
          this.startRot.y = rot.y;
          this.start.x = e.clientX;
          this.start.y = e.clientY;
        },
        onPointerMove: function (e) {
          if (!this.isDragging) return;

          const dx = e.clientX - this.start.x;
          const dy = e.clientY - this.start.y;

          const sx = (this.data.invertX ? -1 : 1) * this.data.speed;
          const sy = (this.data.invertY ? -1 : 1) * this.data.speed;

          // Horizontal drag -> Y-axis (left/right)
          const newY = this.startRot.y + dx * sx;

          // Vertical drag -> X-axis (up/down)
          const newX = this.startRot.x - dy * sy;

          this.el.setAttribute('rotation', `${newX} ${newY} 0`);
        },
        onPointerUp: function () {
          this.isDragging = false;
        }
      });
    </script>

    <style>
      html, body { margin: 0; height: 100%; }

      /* Make scene fill the screen */
      a-scene { position: fixed; inset: 0; }

      /* Keep the back button above the canvas */
      .back-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        background: #38bdf8;
        color: #0f172a;
        border: none;
        border-radius: 8px;
        padding: 10px 14px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        z-index: 9999;
        pointer-events: auto;
      }
      .back-btn:hover { background: #7dd3fc; }

      /* Ensure A-Frame canvas stays below overlay controls */
      canvas.a-canvas, .a-enter-vr { z-index: 0; }
    </style>
  </head>

  <body>
    <a class="back-btn" href="/index.html">‚Üê Back to Menu</a>

    <a-scene>
      <a-assets>
        <!-- Put the GLB inside /public and use absolute path -->
        <a-asset-item id="whale-model" src="/rigged_whale.glb"></a-asset-item>
      </a-assets>

      <!-- Draggable 3D model: rotate freely with mouse/touch -->
      <a-entity
        id="whale"
        gltf-model="#whale-model"
        position="0 2 -5"
        scale="0.5 0.5 0.5"
        rotation="0 300 0"
        animation-mixer
        drag-rotate="speed: 0.4; invertX: false; invertY: false">
      </a-entity>

      <a-sky color="#ADD8E6"></a-sky>
    </a-scene>
  </body>
</html>